# ADR-4. Решение по декомпозиции
   
## Статус
Утверждено.

## Контекст
   ![alt text](/course_work/assets/image-14.png)

### Вариант 1
Вариант с использованием нескольких слоев данных. 
Слой хранения, где находятся обработанные данные о поездках пользователей
Слой приложения, на этом слое хранятся только данные на текущую дату + реализуется бизнес логика для всей функциональности
Слой клиентских данных - дублирует данные "витрины" для конкретного пользователя + реализует UI для пользователя

![alt text](/course_work/assets/image-12.png)

Основные функциональные контексты, которые удалось выявить: 
1) Пользовательский конекст
2) Контекст бизнес-логики
3) Конекст управления данными 

### Вариант 2
Вариант 2 не предусматривает полноценные слои данных. 
Предполагается что на уровне приложения содержатся все данные поездок с "сегодня" и в будущее. 
Раз в сутки производится процедура архивации, где данные о прошедших поездках удаляются, а статистически значимая информация перемещается в "архив".
![alt text](/course_work/assets/image-15.png)

Основные функциональные контексты, которые удалось выявить: 
1) Пользовательский конекст
2) Контекст бизнес-логики
3) Архивное хранение


## Сценарии изменения
#### Сценарии изменения
Сценарии изменений описанные ниже опираются на критические сценарии + на арх драйверы. 
Сценарии:
1) Характер взаимодействия с вендорскими системами.
2) Добавление новых функциональных возможностей по отображению поездки для удовлетворения требования к наибольшей функциональной полноте пользовательского интерфейса
3) Расширение взаимодействия с партнерами в различных функциональных областях, например: появление новых предложений, скидок, возможность брони из интерфейса приложения и тп
4) Появление новых популярных соц сетей
5) Интеграция нового платежного инструмента
6) Отображение в одном интерфейсе поездок для N людей
7) Расширение ретроспективной аналитики как для вендоров, так и для путешественников
8) Внесение пользователями данных не только наперед, но и исторических данных


| N сценария    |Приоритет  | Вероятность   | Вариант 1 | Вариант 2 |
| -             | -         | -             | - | - |
| 1             | Высокий   | Высокая       | Легко. Поддерживается 2 способа обновления данных: batch + stream, любой новый источник подключается за O(1) время и деньги | Легко. Но для загрузки batch придется писать новые коннекторы |
| 2             | Высокий   | Высокая       | Может оказаться не самым простым делом, но есть возможность изменить структуру mart для удобства | Может потребоваться изменение структуры хранения данных для оптимизации или при появлении новых функций и тогда будет очень больно с миграциями |
| 3             | Средний   | Высокая       | Предоставление новой АПИ  | Одинаково с в1 |
| 4             | Низкий    | Высокая       | Легко | Одинаково с в1 |
| 5             | Низкий    | Средняя       | Легко | Одинаково с в1 |
| 6             | Средний   | Высокая       | Для мобилок - сложно. | Одинаково с в1 |
| 7             | Низкий    | Низкая        | Легко | Принципиально невозможно для исторических данных. Для новых - не сложно. |
| 7             | Низкий    | Низкая        | Легко | Посмотреть такие исторические поездки будет принципиально невозможно. Только отразить статистическую инфу |


В случае если объемы хранимых данных являются критичными - лучше выбирать второй вариант. Ограничения этого варианта проявляются в задачах с низким приоритетом. 
Если вопрос объемов хранимых данных не так критичен - лучше использовать первый вариант. Он полностью покрвыает все функциональные возможности второго + дает дополнительную гибкость + позволяет получать доп выгоду от хранимых пользовательких данных через партнерские соглашения. 
   
## Решение
   Использовать вариант 2
   
## Альтернативы
   Вариант 1
   
## Плюсы/минусы

| N     |Знак  | Описание   | 
| -             | -         | -             | 
| 1             | +   | Масштабируемость       | 
| 2             | +   | Унификации обработки данных       |
| 3             | +   | Основной профиль получения данных из источников это стриминг       | 
| 4             | +   | Меньший объем хранимых данных в силу отсутствия хранения историчных и сырых данныъ | 
|5            | -   | При необходимости детального анализа истории потребуются доработки и невозможно будет восстановить историю без выгрузки данных из источников  | 






